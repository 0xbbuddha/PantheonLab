- name: Créer le groupe super-dieu
  group:
    name: super-dieu
    state: present

- name: Ajouter l'utilisateur hera au groupe super-dieu
  user:
    name: "{{ user }}"
    groups: super-dieu
    append: yes

- name: Créer le dossier /opt/hooks
  file:
    path: /opt/hooks
    state: directory
    owner: root
    group: super-dieu
    mode: '0770'

- name: Déployer le script exec_hooks.sh
  copy:
    src: exec_hooks.sh
    dest: /root/exec_hooks.sh
    owner: root
    group: root
    mode: '0750'

- name: Ajouter une tâche cron pour exécuter le script de hooks
  cron:
    name: "Exec hooks privesc hera"
    user: root
    job: "/root/exec_hooks.sh"
    minute: "*/5"

- name: Copier tous les hooks chiffrés dans /opt/hooks
  copy:
    src: "{{ item }}"
    dest: "/opt/hooks/{{ item }}"
    owner: root
    group: root
    mode: '0600'
  with_items:
    - zeus.sh.gpg
    - hera.sh.gpg
    - poseidon.sh.gpg
    - athena.sh.gpg
    - hermes.sh.gpg
    - hades.sh.gpg

- name: Déployer un faux bash_history avec la commande GPG
  copy:
    src: bash_history
    dest: /home/hera/.bash_history
    owner: hera
    group: hera
    mode: '0600'
